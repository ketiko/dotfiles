#!/usr/bin/env bash

set -e

echo "Processing dotfiles"

current_script="${BASH_SOURCE}[0]"
current_dir=$(dirname "$current_script")
root_dir=$(dirname "$current_dir")
stow_dir="$root_dir/stow"
packages=($( dir -A  -1 $stow_dir))

for package in "${packages[@]}"
do
  echo "stowing $package"
  stow -R -v --no-folding --adopt -d "$stow_dir" -t "$HOME" -S "$package"
done

git checkout $stow_dir

ln -vnsf "$HOME/.profile" "$HOME/.zprofile"

source "$HOME/.profile"
